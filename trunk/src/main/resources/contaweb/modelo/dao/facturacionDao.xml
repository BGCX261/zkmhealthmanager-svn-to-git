<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="contaweb.modelo.dao.FacturacionDao">

	<resultMap id="facturacionMap" type="facturacion">
		<result column="id_factura" property="id_factura" />
		<result column="nro_atencion" property="nro_atencion" />
		<result column="codigo_documento" property="codigo_documento_res" />
		<result column="codigo_empresa" property="codigo_empresa" />
		<result column="codigo_sucursal" property="codigo_sucursal" />
		<result column="codigo_comprobante" property="codigo_comprobante" />
		
		<result column="codigo_tercero" property="codigo_tercero" />
		<result column="documento_externo" property="documento_externo" />
		<result column="codigo_empleado" property="codigo_empleado" />
		<result column="fecha" property="fecha" />
		<result column="fecha_vencimiento" property="fecha_vencimiento" />
		<result column="total_cuotas" property="total_cuotas" />
		<result column="plazo" property="plazo" />
		<result column="forma_pago" property="forma_pago" />
		<result column="descripcion" property="descripcion" />
		<result column="observacion" property="observacion" />
		<result column="tipo" property="tipo" />
		<result column="estado" property="estado" />
		<result column="creacion_date" property="creacion_date" />
		<result column="ultimo_update" property="ultimo_update" />
		<result column="delete_date" property="delete_date" />
		<result column="creacion_user" property="creacion_user" />
		<result column="ultimo_user" property="ultimo_user" />
		<result column="delete_user" property="delete_user" />
		<result column="codigo_credito" property="codigo_credito" />
		<result column="remision" property="remision" />
		<result column="prefijo" property="prefijo" />
		<result column="anio" property="anio" />
		<result column="mes" property="mes" />
		<result column="clasificacion" property="clasificacion" />
		<result column="verificado" property="verificado" />
		<result column="retencion" property="retencion" />
		<result column="nro_ingreso" property="nro_ingreso" />
		<result column="fecha_inicio" property="fecha_inicio" />
		<result column="fecha_final" property="fecha_final" />
		<result column="codigo_administradora" property="codigo_administradora" />
		<result column="id_plan" property="id_plan" />
		<result column="nro_contrato" property="nro_contrato" />
		<result column="nro_poliza" property="nro_poliza" />
		<result column="valor_total" property="valor_total" />
		<result column="valor_cuota" property="valor_cuota" />
		<result column="valor_copago" property="valor_copago" />
		<result column="nocopago" property="nocopago" />
		<result column="dto_factura" property="dto_factura" />
		<result column="dto_copago" property="dto_copago" />
		<result column="cop_canc" property="cop_canc" />
		<result column="factura" property="factura" />
		<result column="post" property="post" />
		<result column="tipo_identificacion" property="tipo_identificacion" />
		<result column="asesor" property="asesor" />
		<result column="gestor" property="gestor" />
		<result column="dia_pago" property="dia_pago" />
		<result column="codigo_fiador1" property="codigo_fiador1" />
		<result column="codigo_fiador2" property="codigo_fiador2" />
		<result column="nro_cuenta" property="nro_cuenta" />
		<result column="es_credito" property="es_credito" />
		<result column="radicado" property="radicado" />
		<result column="fecha_erradicacion" property="fecha_erradicacion" />
		<result column="auditado" property="auditado" />
		<result column="valor_negocio" property="valor_negocio" />
		<result column="porc_interes" property="porc_interes" />
		<result column="c_inicial" property="c_inicial" />
		<result column="abono_inicial" property="abono_inicial" />
		<result column="descuento_pp" property="descuento_pp" />
		<result column="medio_pago" property="medio_pago" />
		<result column="reteica" property="reteica" />
		<result column="reteiva" property="reteiva" />
		<result column="fecha_glosa" property="fecha_glosa" />
		<result column="motivo_glosa" property="motivo_glosa" />
		<result column="valor_glosa_inicial" property="valor_glosa_inicial" />
		<result column="valor_glosa_aceptada" property="valor_glosa_aceptada" />
		<result column="valor_glosa_noaceptada" property="valor_glosa_noaceptada" />
		<result column="observaciones" property="observaciones" />
		<result column="estado_glosa" property="estado_glosa" />
		<result column="valor_glosa_levantada" property="valor_glosa_levantada" />
		<result column="valor_glosa_ratificada" property="valor_glosa_ratificada" />
		<result column="valor_pagar_factura" property="valor_pagar_factura" />
		<result column="cuenta_retencion" property="cuenta_retencion" />
		<result column="anio_retencion" property="anio_retencion" />
		<result column="codigo_rp" property="codigo_rp" />
		<result column="nro_dias_reportados" property="nro_dias_reportados" />
		<result column="tarifa_usuario_dia" property="tarifa_usuario_dia" />
		<result column="concepto" property="concepto" />
		<result column="fuenta_radicado" property="fuenta_radicado" />
		<result column="documento_radicado" property="documento_radicado" />
		<result column="tipo_glosa" property="tipo_glosa" />
		<result column="estado_respuesta_glosa" property="estado_respuesta_glosa" />
		<result column="fact_glosada" property="fact_glosada" />
		<result column="fecha_devolucion_factura" property="fecha_devolucion_factura" />
		<result column="fecha_respuesta_glosa" property="fecha_respuesta_glosa" />
		<result column="fecha_respuesta_definitiva" property="fecha_respuesta_definitiva" />
		<result column="respueta_glosa" property="respueta_glosa" />
		<result column="observacion_glosa" property="observacion_glosa" />
		<result column="observacion_respuesta" property="observacion_respuesta" />
		<result column="observacion_definitiva_glosa" property="observacion_definitiva_glosa" />
		<result column="respuesta_definitiva" property="respuesta_definitiva" />
		<result column="concepto_glosa" property="concepto_glosa" />
		<result column="codigo_obligacion" property="codigo_obligacion" />
		<result column="codigo_centro" property="codigo_centro" />
		<result column="descipcion_mes_facturado" property="descipcion_mes_facturado" />
		<result column="poblacion_segun_base_datos" property="poblacion_segun_base_datos" />
		<result column="descripcion_nro_contrato" property="descripcion_nro_contrato" />
		<result column="descripcion_tipo_servicio" property="descripcion_tipo_servicio" />
		<result column="fecha_contabilizacion" property="fecha_contabilizacion" />
		<result column="aplica_descuento" property="aplica_descuento" />
		
		<result column="codigo_paquete" property="codigo_paquete" />
		<result column="motivo_anulacion" property="motivo_anulacion" />

		<result column="total_factura_clinica" property="total_factura_clinica" />
		<result column="tiene_urgencia" property="tiene_urgencia" />
		<result column="tiene_observacion" property="tiene_observacion" />
		<result column="tiene_hospitalizacion" property="tiene_hospitalizacion" />
		<result column="tiene_recien_nacido" property="tiene_recien_nacido" />

		<!-- Optimizacion -->
		<result column="nombre1" property="admision.paciente.nombre1" />
		<result column="nombre2" property="admision.paciente.nombre2" />
		<result column="apellido1" property="admision.paciente.apellido1" />
		<result column="apellido2" property="admision.paciente.apellido2" />
		<result column="tipo_identificacion_pac" property="admision.paciente.tipo_identificacion" />
		<result column="fecha_nacimiento" property="admision.paciente.fecha_nacimiento" />
		<result column="documento" property="admision.paciente.documento" />
		<result column="sexo" property="admision.paciente.sexo" />
		<result column="codigo_dpto" property="admision.paciente.codigo_dpto" />
		<result column="codigo_municipio" property="admision.paciente.codigo_municipio" />
		<result column="zona" property="admision.paciente.zona" />
		<result column="estrato" property="admision.paciente.estrato" />
		<result column="tipo_usuario" property="admision.paciente.tipo_usuario" />
		<result column="codigo_ving" property="evia.codigo" />
		<result column="descripcion_ving" property="evia.descripcion" />

		<result column="nombre_administradora" property="administradora.nombre" />
		<result column="formato_fecha_rips" property="administradora.formato_fecha_rips" />
		<result column="adm_nro_autorizacion" property="admision.nro_autorizacion" />
		<result column="admision_parto" property="admision.admision_parto" />
		<result column="via_ingreso_ad" property="admision.via_ingreso" />
		<result column="programa_lab_pyp_ad" property="admision.programa_lab_pyp" />
		<result column="id_plan_ad" property="admision.id_plan" />
		<result column="causa_externa_ad" property="admision.causa_externa" />
		<result column="particular_ad" property="admision.particular" />

	</resultMap>

	<insert id="crear" parameterType="facturacion">
		<selectKey keyProperty="id_factura" resultType="java.lang.Long">
			INSERT
			INTO contaweb.facturacion (codigo_empresa,codigo_sucursal,
			codigo_comprobante,codigo_documento,codigo_tercero,
			documento_externo,codigo_empleado,fecha,
			fecha_vencimiento,total_cuotas,plazo,
			forma_pago,descripcion,observacion,
			tipo,estado,creacion_date,
			ultimo_update,delete_date,creacion_user,
			ultimo_user,delete_user,codigo_credito,
			remision,prefijo,anio,
			mes,clasificacion,verificado,
			retencion,nro_ingreso,fecha_inicio,
			fecha_final,codigo_administradora,id_plan,
			nro_contrato,nro_poliza,valor_total,
			valor_cuota,valor_copago,nocopago,
			dto_factura,dto_copago,cop_canc,
			factura,post,tipo_identificacion,
			asesor,gestor,dia_pago,
			codigo_fiador1,codigo_fiador2,nro_cuenta,
			es_credito,radicado,fecha_erradicacion,
			auditado,valor_negocio,porc_interes,
			c_inicial,abono_inicial,descuento_pp,
			medio_pago,reteica,reteiva,
			fecha_glosa,motivo_glosa,valor_glosa_inicial,
			valor_glosa_aceptada,valor_glosa_noaceptada,observaciones,
			estado_glosa,valor_glosa_levantada,valor_glosa_ratificada,
			valor_pagar_factura,cuenta_retencion,anio_retencion,
			codigo_rp,
			nro_dias_reportados,tarifa_usuario_dia,concepto,
			fuenta_radicado,documento_radicado,tipo_glosa,estado_respuesta_glosa
			,fact_glosada,fecha_devolucion_factura,
			fecha_respuesta_glosa,fecha_respuesta_definitiva,respueta_glosa,
			observacion_glosa,observacion_respuesta,observacion_definitiva_glosa,
			respuesta_definitiva,concepto_glosa,codigo_obligacion,codigo_centro,descipcion_mes_facturado,
			poblacion_segun_base_datos, descripcion_nro_contrato,
			descripcion_tipo_servicio,
			fecha_contabilizacion, aplica_descuento, nro_atencion,
			codigo_paquete, motivo_anulacion)

			VALUES (#{codigo_empresa},#{codigo_sucursal},
			#{codigo_comprobante},#{codigo_documento_res},#{codigo_tercero},
			#{documento_externo},#{codigo_empleado},#{fecha},
			#{fecha_vencimiento},#{total_cuotas},#{plazo},
			#{forma_pago},#{descripcion},#{observacion},
			#{tipo},#{estado},#{creacion_date},
			#{ultimo_update},#{delete_date},#{creacion_user},
			#{ultimo_user},#{delete_user},#{codigo_credito},
			#{remision},#{prefijo},#{anio},
			#{mes},#{clasificacion},#{verificado},
			#{retencion},#{nro_ingreso},#{fecha_inicio},
			#{fecha_final},#{codigo_administradora},#{id_plan},
			#{nro_contrato},#{nro_poliza},#{valor_total},
			#{valor_cuota},#{valor_copago},#{nocopago},
			#{dto_factura},#{dto_copago},#{cop_canc},
			#{factura},#{post},#{tipo_identificacion},
			#{asesor},#{gestor},#{dia_pago},
			#{codigo_fiador1},#{codigo_fiador2},#{nro_cuenta},
			#{es_credito},#{radicado},#{fecha_erradicacion},
			#{auditado},#{valor_negocio},#{porc_interes},
			#{c_inicial},#{abono_inicial},#{descuento_pp},
			#{medio_pago},#{reteica},#{reteiva},
			#{fecha_glosa},#{motivo_glosa},#{valor_glosa_inicial},
			#{valor_glosa_aceptada},#{valor_glosa_noaceptada},#{observaciones},
			#{estado_glosa},#{valor_glosa_levantada},#{valor_glosa_ratificada},
			#{valor_pagar_factura},#{cuenta_retencion},#{anio_retencion},
			#{codigo_rp},#{nro_dias_reportados},#{tarifa_usuario_dia},#{concepto},
			#{fuenta_radicado},#{documento_radicado},#{tipo_glosa},#{estado_respuesta_glosa}
			,#{fact_glosada},#{fecha_devolucion_factura},
			#{fecha_respuesta_glosa},#{fecha_respuesta_definitiva},#{respueta_glosa},
			#{observacion_glosa},#{observacion_respuesta},#{observacion_definitiva_glosa},
			#{respuesta_definitiva},#{concepto_glosa},#{codigo_obligacion},
			#{codigo_centro},#{descipcion_mes_facturado},
			#{poblacion_segun_base_datos},
			#{descripcion_nro_contrato},
			#{descripcion_tipo_servicio},#{fecha_contabilizacion},
			#{aplica_descuento},#{nro_atencion},
			#{codigo_paquete}, #{motivo_anulacion})
			RETURNING id_factura;
		</selectKey>
	</insert>

	<update id="actualizar" parameterType="facturacion">
		update
		contaweb.facturacion set codigo_empresa = #{codigo_empresa},
		codigo_sucursal = #{codigo_sucursal},codigo_comprobante =
		#{codigo_comprobante},
		codigo_documento =
		#{codigo_documento_res},codigo_tercero = #{codigo_tercero},
		documento_externo = #{documento_externo},codigo_empleado =
		#{codigo_empleado},
		fecha = #{fecha},fecha_vencimiento =
		#{fecha_vencimiento},
		total_cuotas = #{total_cuotas},plazo = #{plazo},
		forma_pago = #{forma_pago},descripcion = #{descripcion},
		observacion =
		#{observacion},tipo = #{tipo},
		estado = #{estado},
		<!--  creacion_date =
		#{creacion_date}, -->
		ultimo_update = #{ultimo_update},delete_date =
		#{delete_date},
		<!-- 
		creacion_user = #{creacion_user},
		-->
		ultimo_user =
		#{ultimo_user},
		delete_user = #{delete_user},codigo_credito =
		#{codigo_credito},
		remision = #{remision},prefijo = #{prefijo},
		anio =
		#{anio},mes = #{mes},
		clasificacion = #{clasificacion},verificado =
		#{verificado},
		retencion = #{retencion},nro_ingreso = #{nro_ingreso},
		fecha_inicio = #{fecha_inicio},fecha_final = #{fecha_final},
		codigo_administradora = #{codigo_administradora},id_plan = #{id_plan},
		nro_contrato = #{nro_contrato},nro_poliza = #{nro_poliza},
		valor_total
		= #{valor_total},valor_cuota = #{valor_cuota},
		valor_copago =
		#{valor_copago},nocopago = #{nocopago},
		dto_factura =
		#{dto_factura},dto_copago = #{dto_copago},
		cop_canc =
		#{cop_canc},factura = #{factura},
		post = #{post},tipo_identificacion =
		#{tipo_identificacion},
		asesor = #{asesor},gestor = #{gestor},
		dia_pago
		= #{dia_pago},codigo_fiador1 = #{codigo_fiador1},
		codigo_fiador2 =
		#{codigo_fiador2},nro_cuenta = #{nro_cuenta},
		es_credito =
		#{es_credito},radicado = #{radicado},
		fecha_erradicacion =
		#{fecha_erradicacion},auditado = #{auditado},
		valor_negocio =
		#{valor_negocio},porc_interes = #{porc_interes},
		c_inicial =
		#{c_inicial},abono_inicial = #{abono_inicial},
		descuento_pp =
		#{descuento_pp},medio_pago = #{medio_pago},
		reteica =
		#{reteica},reteiva = #{reteiva},
		fecha_glosa =
		#{fecha_glosa},motivo_glosa = #{motivo_glosa},
		valor_glosa_inicial =
		#{valor_glosa_inicial},valor_glosa_aceptada = #{valor_glosa_aceptada},
		valor_glosa_noaceptada = #{valor_glosa_noaceptada},observaciones =
		#{observaciones},
		estado_glosa = #{estado_glosa},valor_glosa_levantada
		= #{valor_glosa_levantada},
		valor_glosa_ratificada =
		#{valor_glosa_ratificada},valor_pagar_factura =
		#{valor_pagar_factura},
		cuenta_retencion =
		#{cuenta_retencion},anio_retencion = #{anio_retencion},
		codigo_rp =
		#{codigo_rp},
		nro_dias_reportados =
		#{nro_dias_reportados},tarifa_usuario_dia = #{tarifa_usuario_dia},
		concepto = #{concepto},
		fuenta_radicado =
		#{fuenta_radicado},documento_radicado = #{documento_radicado},
		tipo_glosa = #{tipo_glosa},estado_respuesta_glosa =
		#{estado_respuesta_glosa},
		fact_glosada =
		#{fact_glosada},fecha_devolucion_factura =
		#{fecha_devolucion_factura},
		fecha_respuesta_glosa =
		#{fecha_respuesta_glosa},fecha_respuesta_definitiva =
		#{fecha_respuesta_definitiva},
		respueta_glosa =
		#{respueta_glosa},observacion_glosa = #{observacion_glosa},
		observacion_respuesta =
		#{observacion_respuesta},observacion_definitiva_glosa =
		#{observacion_definitiva_glosa},
		respuesta_definitiva =
		#{respuesta_definitiva},concepto_glosa = #{concepto_glosa},
		codigo_obligacion=#{codigo_obligacion}, codigo_centro =
		#{codigo_centro}, descipcion_mes_facturado =
		#{descipcion_mes_facturado},
		poblacion_segun_base_datos =
		#{poblacion_segun_base_datos},
		descripcion_nro_contrato =
		#{descripcion_nro_contrato},
		descripcion_tipo_servicio =
		#{descripcion_tipo_servicio},
		fecha_contabilizacion =
		#{fecha_contabilizacion},
		aplica_descuento = #{aplica_descuento},
		nro_atencion = #{nro_atencion},
		codigo_paquete = #{codigo_paquete}, 
		motivo_anulacion = #{motivo_anulacion} 
		where id_factura = #{id_factura}
	</update>

	<select id="consultar" resultMap="facturacionMap" parameterType="facturacion">
		select 
		id_factura, nro_atencion, 
		codigo_empresa,codigo_sucursal,
		codigo_comprobante,codigo_documento,codigo_tercero,documento_externo,
		codigo_empleado,fecha,fecha_vencimiento,total_cuotas,
		plazo,forma_pago,descripcion,observacion,
		tipo,estado,creacion_date,ultimo_update,
		delete_date,creacion_user,ultimo_user,delete_user,
		codigo_credito,remision,prefijo,anio,
		mes,clasificacion,verificado,retencion,
		nro_ingreso,fecha_inicio,fecha_final,codigo_administradora,
		id_plan,nro_contrato,nro_poliza,valor_total,
		valor_cuota,valor_copago,nocopago,dto_factura,
		dto_copago,cop_canc,factura,post,
		tipo_identificacion,asesor,gestor,dia_pago,
		codigo_fiador1,codigo_fiador2,nro_cuenta,es_credito,
		radicado,fecha_erradicacion,auditado,valor_negocio,
		porc_interes,c_inicial,abono_inicial,descuento_pp,
		medio_pago,reteica,reteiva,fecha_glosa,
		motivo_glosa,valor_glosa_inicial,valor_glosa_aceptada,valor_glosa_noaceptada,
		observaciones,estado_glosa,valor_glosa_levantada,valor_glosa_ratificada,
		valor_pagar_factura,cuenta_retencion,anio_retencion,codigo_rp,nro_dias_reportados,
		tarifa_usuario_dia,concepto,
		fuenta_radicado,documento_radicado,tipo_glosa,estado_respuesta_glosa,fact_glosada,fecha_devolucion_factura,fecha_respuesta_glosa,
		fecha_respuesta_definitiva,respueta_glosa,observacion_glosa,observacion_respuesta,
		observacion_definitiva_glosa,respuesta_definitiva,concepto_glosa,codigo_obligacion,codigo_centro,
		descipcion_mes_facturado, poblacion_segun_base_datos,
		descripcion_nro_contrato, descripcion_tipo_servicio,
		fecha_contabilizacion,aplica_descuento,
		codigo_paquete, motivo_anulacion 
		from contaweb.facturacion 
		where 
		id_factura = #{id_factura} 
	</select>
	
	<select id="consultar_informacion" resultMap="facturacionMap" parameterType="facturacion">
		select 
		id_factura, nro_atencion, 
		codigo_empresa,codigo_sucursal,
		codigo_comprobante,codigo_documento,codigo_tercero,documento_externo,
		codigo_empleado,fecha,fecha_vencimiento,total_cuotas,
		plazo,forma_pago,descripcion,observacion,
		tipo,estado,creacion_date,ultimo_update,
		delete_date,creacion_user,ultimo_user,delete_user,
		codigo_credito,remision,prefijo,anio,
		mes,clasificacion,verificado,retencion,
		nro_ingreso,fecha_inicio,fecha_final,codigo_administradora,
		id_plan,nro_contrato,nro_poliza,valor_total,
		valor_cuota,valor_copago,nocopago,dto_factura,
		dto_copago,cop_canc,factura,post,
		tipo_identificacion,asesor,gestor,dia_pago,
		codigo_fiador1,codigo_fiador2,nro_cuenta,es_credito,
		radicado,fecha_erradicacion,auditado,valor_negocio,
		porc_interes,c_inicial,abono_inicial,descuento_pp,
		medio_pago,reteica,reteiva,fecha_glosa,
		motivo_glosa,valor_glosa_inicial,valor_glosa_aceptada,valor_glosa_noaceptada,
		observaciones,estado_glosa,valor_glosa_levantada,valor_glosa_ratificada,
		valor_pagar_factura,cuenta_retencion,anio_retencion,codigo_rp,nro_dias_reportados,
		tarifa_usuario_dia,concepto,
		fuenta_radicado,documento_radicado,tipo_glosa,estado_respuesta_glosa,fact_glosada,fecha_devolucion_factura,fecha_respuesta_glosa,
		fecha_respuesta_definitiva,respueta_glosa,observacion_glosa,observacion_respuesta,
		observacion_definitiva_glosa,respuesta_definitiva,concepto_glosa,codigo_obligacion,codigo_centro,
		descipcion_mes_facturado, poblacion_segun_base_datos,
		descripcion_nro_contrato, descripcion_tipo_servicio,
		fecha_contabilizacion,aplica_descuento,
		codigo_paquete, motivo_anulacion 
		from contaweb.facturacion where codigo_empresa = #{codigo_empresa}
		and
		codigo_sucursal = #{codigo_sucursal}
		<if test="codigo_comprobante != null">and codigo_comprobante = #{codigo_comprobante}</if>
		<if test="codigo_documento_res != null">and codigo_documento = #{codigo_documento_res}</if>
		<if test="codigo_tercero != null">and codigo_tercero = #{codigo_tercero}</if>
		<if test="nro_ingreso != null">and nro_ingreso = #{nro_ingreso}</if>
	</select>

	<delete id="eliminar" parameterType="facturacion">
		delete from
		contaweb.facturacion
		where id_factura = #{id_factura} 
	</delete>

	<select id="listarRegistros" resultMap="facturacionMap"
		parameterType="java.util.Map">
		SELECT
		id_factura,
		nro_atencion,
		codigo_empresa,
		codigo_sucursal,
		codigo_comprobante,
		codigo_documento,
		codigo_tercero,
		documento_externo,
		codigo_empleado,
		fecha,
		fecha_vencimiento,
		total_cuotas,
		plazo,
		forma_pago,
		descripcion,
		observacion,
		tipo,
		estado,
		creacion_date,
		ultimo_update,
		delete_date,
		creacion_user,
		ultimo_user,
		delete_user,
		codigo_credito,
		remision,
		prefijo,
		anio,
		mes,
		clasificacion,
		verificado,
		retencion,
		nro_ingreso,
		fecha_inicio,
		fecha_final,
		codigo_administradora,
		id_plan,
		nro_contrato,
		nro_poliza,
		valor_total,
		valor_cuota,
		valor_copago,
		nocopago,
		dto_factura,
		dto_copago,
		cop_canc,
		factura,
		post,
		tipo_identificacion,
		asesor,
		gestor,
		dia_pago,
		codigo_fiador1,
		codigo_fiador2,
		nro_cuenta,
		es_credito,
		radicado,
		fecha_erradicacion,
		auditado,
		valor_negocio,
		porc_interes,
		c_inicial,
		abono_inicial,
		descuento_pp,
		medio_pago,
		reteica,
		reteiva,
		valor_debito,
		valor_credito,
		tipo_alumno,
		grado,
		cobra_flete,
		valor_flete,
		tercero_flete,
		codigo_archivo,
		porcentaje_comision,
		valor_comision,
		simcard,
		fecha_glosa,
		motivo_glosa,
		valor_glosa_inicial,
		valor_glosa_aceptada,
		valor_glosa_noaceptada,
		observaciones,
		estado_glosa,
		valor_glosa_levantada,
		valor_glosa_ratificada,
		valor_pagar_factura,
		cuenta_retencion,
		anio_retencion,
		codigo_rp,
		codigo_obligacion,
		nro_dias_reportados,
		tarifa_usuario_dia,
		concepto,
		fuente_factura,
		documento_factura,
		fuenta_radicado,
		documento_radicado,
		tipo_glosa,
		fact_glosada,
		fecha_devolucion_factura,
		fecha_respuesta_glosa,
		fecha_respuesta_definitiva,
		concepto_glosa,
		respueta_glosa,
		observacion_glosa,
		observacion_respuesta,
		observacion_definitiva_glosa,
		respuesta_definitiva,
		estado_respuesta_glosa,
		exportado,
		codigo_centro,
		motivo_anulacion, 
		descipcion_mes_facturado,
		poblacion_segun_base_datos,
		descripcion_nro_contrato,
		descripcion_tipo_servicio,
		codigo_documento_temporal,
		fecha_contabilizacion,
		aplica_descuento,
		codigo_paquete,
		nombre1,
		nombre2,
		apellido1,
		apellido2,
		tipo_identificacion_pac,
		fecha_nacimiento,
		documento,
		sexo,
		codigo_dpto,
		codigo_municipio,
		zona,
		estrato,
		tipo_usuario,
		codigo_ving,
		descripcion_ving,
		nombre_administradora,
		formato_fecha_rips,
		adm_nro_autorizacion,
		admision_parto,
		via_ingreso_ad,
		programa_lab_pyp_ad,
		id_plan_ad,
		causa_externa_ad,
		particular_ad 
		from vr_facturacion
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="codigo_empresa != null">AND codigo_empresa = #{codigo_empresa}</if>
			<if test="codigo_sucursal != null">AND codigo_sucursal = #{codigo_sucursal}</if>
			<if test="post != null">AND post = #{post}</if>
			<if test="parameter != null">AND ${parameter} like '${value}'</if>
			<if test="codigo_administradora != null">AND codigo_administradora = #{codigo_administradora} </if>
			<if test="codigo_tercero != null">AND codigo_tercero = #{codigo_tercero}</if>
			<if test="id_plan != null"> AND id_plan = #{id_plan}</if>
			<if test="id_plan_bus != null">
				AND id_plan like '%${id_plan_bus}%'
			</if>

			<if test="contratos_listado != null">
				AND id_plan IN
				<foreach collection="contratos_listado" item="i" open="("
					separator="," close=")">
					#{i}
				</foreach>
			</if>
			
			<if test="vias_ingreso != null">
				<foreach collection="vias_ingreso" index="ix" item="i" separator=","
					open="AND via_ingreso_ad IN (" close=")">
					#{i}
				</foreach>
			</if>

			<if test="tipo_in != null">
				<foreach collection="tipo_in" index="ix" item="i" separator=","
					open="AND tipo IN (" close=")">
					#{i}
				</foreach>
			</if>
			
			<if test="codigo_documento_null != null">
				and codigo_documento is null 
			</if>
			
			<if test="codigo_documento_notnull != null">
				and codigo_documento is not null 
			</if>
			
			<if test="radicado != null">AND radicado = #{radicado}</if>
			<if test="tipo != null">AND tipo = #{tipo}</if>
			<if test="fecha_in != null"><![CDATA[ AND CAST(fecha AS DATE) >= #{fecha_in}]]></if>
			<if test="fecha_fn != null"><![CDATA[ AND CAST(fecha AS DATE) <= #{fecha_fn}]]></if>
			<if test="fecha_inicio != null"><![CDATA[AND fecha between #{fecha_inicio} and #{fecha_final}]]></if>
			<if test="filtro_factura != null"><![CDATA[ AND factura in (${filtro_factura}) ]]></if>
			<if test="estado != null"> AND estado = #{estado}</if>
			<if test="factura != null"> AND factura = #{factura}</if>
			<if test="no_anulada != null"> and delete_date is null</if>
			<if test="consulta_para_radicar != null">
				and (tipo = 'IND' or tipo ='GEN_CAP' or
				tipo = 'GEN_AGR')
			</if>
			<if test="nivel_busqueda != null">
				AND (${nivel_busqueda})
			</if>
			<if test="rango_fecha != null">
				and cast(fecha as date) between cast(#{fecha_inicio} as
				date) and cast(#{fecha_final} as date)
			</if>

			<if test="listado_centros != null">
				<foreach collection="listado_centros" index="ix" item="i"
					separator="," open="AND codigo_centro IN (" close=")">
					#{i}
				</foreach>
			</if>

		</trim>

		<if test="orden_factura != null">
			${orden_factura}
		</if>

		<if test="limite_paginado != null">
			${limite_paginado}
		</if>
	</select>
	
	<select id="listarFacturacion_rips" resultMap="facturacionMap"
		parameterType="java.util.Map">
		SELECT
		id_factura,
		nro_atencion,
		codigo_empresa,
		codigo_sucursal,
		codigo_comprobante,
		codigo_documento,
		codigo_tercero,
		documento_externo,
		codigo_empleado,
		fecha,
		fecha_vencimiento,
		total_cuotas,
		plazo,
		forma_pago,
		descripcion,
		observacion,
		tipo,
		estado,
		creacion_date,
		ultimo_update,
		delete_date,
		creacion_user,
		ultimo_user,
		delete_user,
		codigo_credito,
		remision,
		prefijo,
		anio,
		mes,
		clasificacion,
		verificado,
		retencion,
		nro_ingreso,
		fecha_inicio,
		fecha_final,
		codigo_administradora,
		id_plan,
		nro_contrato,
		nro_poliza,
		valor_total,
		valor_cuota,
		valor_copago,
		nocopago,
		dto_factura,
		dto_copago,
		cop_canc,
		factura,
		post,
		tipo_identificacion,
		asesor,
		gestor,
		dia_pago,
		codigo_fiador1,
		codigo_fiador2,
		nro_cuenta,
		es_credito,
		radicado,
		fecha_erradicacion,
		auditado,
		valor_negocio,
		porc_interes,
		c_inicial,
		abono_inicial,
		descuento_pp,
		medio_pago,
		reteica,
		reteiva,
		valor_debito,
		valor_credito,
		tipo_alumno,
		grado,
		cobra_flete,
		valor_flete,
		tercero_flete,
		codigo_archivo,
		porcentaje_comision,
		valor_comision,
		simcard,
		fecha_glosa,
		motivo_glosa,
		valor_glosa_inicial,
		valor_glosa_aceptada,
		valor_glosa_noaceptada,
		observaciones,
		estado_glosa,
		valor_glosa_levantada,
		valor_glosa_ratificada,
		valor_pagar_factura,
		cuenta_retencion,
		anio_retencion,
		codigo_rp,
		codigo_obligacion,
		nro_dias_reportados,
		tarifa_usuario_dia,
		concepto,
		fuente_factura,
		documento_factura,
		fuenta_radicado,
		documento_radicado,
		tipo_glosa,
		fact_glosada,
		fecha_devolucion_factura,
		fecha_respuesta_glosa,
		fecha_respuesta_definitiva,
		concepto_glosa,
		respueta_glosa,
		observacion_glosa,
		observacion_respuesta,
		observacion_definitiva_glosa,
		respuesta_definitiva,
		estado_respuesta_glosa,
		exportado,
		codigo_centro,
		descipcion_mes_facturado,
		poblacion_segun_base_datos,
		descripcion_nro_contrato,
		descripcion_tipo_servicio,
		codigo_documento_temporal,
		fecha_contabilizacion,
		aplica_descuento,
		nombre1,
		nombre2,
		apellido1,
		apellido2,
		tipo_identificacion_pac,
		fecha_nacimiento,
		documento,
		sexo,
		codigo_dpto,
		codigo_municipio,
		zona,
		estrato,
		tipo_usuario,
		codigo_ving,
		descripcion_ving,
		nombre_administradora,
		formato_fecha_rips,
		adm_nro_autorizacion,
		admision_parto,
		via_ingreso_ad,
		programa_lab_pyp_ad,
		id_plan_ad,
		causa_externa_ad,
		particular_ad,
		total_factura_clinica,
		tiene_urgencia,
		tiene_observacion,
		tiene_hospitalizacion,
		tiene_recien_nacido
		from
		vr_facturacion_rips
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="codigo_empresa != null">AND codigo_empresa = #{codigo_empresa}</if>
			<if test="codigo_sucursal != null">AND codigo_sucursal = #{codigo_sucursal}</if>
			<if test="post != null">AND post = #{post}</if>
			<if test="parameter != null">AND ${parameter} like '${value}'</if>
			<if test="codigo_administradora != null">AND codigo_administradora = #{codigo_administradora} </if>
			<if test="id_plan != null"> AND id_plan = #{id_plan}</if>
			<if test="id_plan_bus != null">
				AND id_plan like '%${id_plan_bus}%'
			</if>

			<if test="contratos_listado != null">
				AND id_plan IN
				<foreach collection="contratos_listado" item="i" open="("
					separator="," close=")">
					#{i}
				</foreach>
			</if>

			<if test="tipo_in != null">
				<foreach collection="tipo_in" index="ix" item="i" separator=","
					open="AND tipo IN (" close=")">
					#{i}
				</foreach>
			</if>
			
			<if test="vias_ingreso != null">
				<foreach collection="vias_ingreso" index="ix" item="i" separator=","
					open="AND via_ingreso_ad IN (" close=")">
					#{i}
				</foreach>
			</if>
			
			<if test="radicado != null">AND radicado = #{radicado}</if>
			<if test="tipo != null">AND tipo = #{tipo}</if>
			<if test="fecha_in != null"><![CDATA[ AND CAST(fecha AS DATE) >= #{fecha_in}]]></if>
			<if test="fecha_fn != null"><![CDATA[ AND CAST(fecha AS DATE) <= #{fecha_fn}]]></if>
			<if test="fecha_inicio != null"><![CDATA[AND fecha between #{fecha_inicio} and #{fecha_final}]]></if>
			<if test="filtro_factura != null"><![CDATA[ AND factura in (${filtro_factura}) ]]></if>
			<if test="estado != null"> AND estado = #{estado}</if>
			<if test="factura != null"> AND factura = #{factura}</if>
			<if test="no_anulada != null"> and delete_date is null</if>
			<if test="consulta_para_radicar != null">
				and (tipo = 'IND' or tipo ='GEN_CAP' or
				tipo = 'GEN_AGR')
			</if>
			<if test="nivel_busqueda != null">
				AND (${nivel_busqueda})
			</if>
			<if test="rango_fecha != null">
				and cast(fecha as date) between cast(#{fecha_inicio} as
				date) and cast(#{fecha_final} as date)
			</if>

			<if test="listado_centros != null">
				<foreach collection="listado_centros" index="ix" item="i"
					separator="," open="AND codigo_centro IN (" close=")">
					#{i}
				</foreach>
			</if>

		</trim>

		<if test="orden_factura != null">
			${orden_factura}
		</if>

		<if test="limite_paginado != null">
			${limite_paginado}
		</if>

	</select>
	

	<select id="totalResultados" resultType="java.lang.Integer"
		parameterType="java.util.Map">
		select count(1)
		from vr_facturacion  
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="codigo_empresa != null">AND codigo_empresa = #{codigo_empresa}</if>
			<if test="codigo_sucursal != null">AND codigo_sucursal = #{codigo_sucursal}</if>
			<if test="post != null">AND post = #{post}</if>
			<if test="parameter != null">AND ${parameter} like '${value}'</if>
			<if test="codigo_administradora != null">AND codigo_administradora = #{codigo_administradora} </if>
			<if test="id_plan != null"> AND id_plan = #{id_plan}</if>
			<if test="id_plan_bus != null">
				AND id_plan like '%${id_plan_bus}%'
			</if>

			<if test="contratos_listado != null">
				AND id_plan IN
				<foreach collection="contratos_listado" item="i" open="("
					separator="," close=")">
					#{i}
				</foreach>
			</if>

			<if test="tipo_in != null">
				<foreach collection="tipo_in" index="ix" item="i" separator=","
					open="AND tipo IN (" close=")">
					#{i}
				</foreach>
			</if>
			<if test="radicado != null">AND radicado = #{radicado}</if>
			<if test="tipo != null">AND tipo = #{tipo}</if>
			<if test="fecha_in != null"><![CDATA[ AND CAST(fecha AS DATE) >= #{fecha_in}]]></if>
			<if test="fecha_fn != null"><![CDATA[ AND CAST(fecha AS DATE) <= #{fecha_fn}]]></if>
			<if test="fecha_inicio != null"><![CDATA[AND fecha between #{fecha_inicio} and #{fecha_final}]]></if>
			<if test="filtro_factura != null"><![CDATA[ AND factura in (${filtro_factura}) ]]></if>
			<if test="estado != null"> AND estado = #{estado}</if>
			<if test="factura != null"> AND factura = #{factura}</if>
			<if test="no_anulada != null"> and delete_date is null</if>
			<if test="consulta_para_radicar != null">
				and (tipo = 'IND' or tipo ='GEN_CAP' or
				tipo = 'GEN_AGR')
			</if>
			<if test="nivel_busqueda != null">
				AND (${nivel_busqueda})
			</if>
			<if test="rango_fecha != null">
				and cast(fecha as date) between cast(#{fecha_inicio} as
				date) and cast(#{fecha_final} as date)
			</if>

			<if test="listado_centros != null">
				<foreach collection="listado_centros" index="ix" item="i"
					separator="," open="AND codigo_centro IN (" close=")">
					#{i}
				</foreach>
			</if>

		</trim>
	</select>
	
	

	<select id="getValorTotalYRecuperado" resultType="java.util.Map"
		parameterType="java.util.Map">
		SET ENABLE_SEQSCAN TO OFF;
		SELECT fact.id_factura, CAST(fact.valor_total AS double precision) AS
		valor_total,
		to_char(fact.fecha, 'yyyy-MM-dd') AS fecha, CAST(caj.valor_recibo AS
		double precision) AS
		valor_recibo
		FROM contaweb.facturacion AS fact
		LEFT
		JOIN contaweb.caja AS caj ON (caj.codigo_empresa =
		fact.codigo_empresa
		AND caj.codigo_sucursal = fact.codigo_sucursal
		AND caj.nro_ingreso =
		fact.nro_ingreso AND caj.codigo_tercero =
		fact.codigo_tercero)
		WHERE
		fact.codigo_empresa = #{codigo_empresa} AND fact.codigo_sucursal =
		#{codigo_sucursal}
		AND fact.nro_ingreso = #{nro_ingreso} AND
		fact.codigo_tercero =
		#{nro_identificacion}
		LIMIT 1 OFFSET 0
	</select>


	<select id="listar_facturas" resultType="java.util.Map"
		parameterType="java.util.Map">
		select codigo_empresa, codigo_sucursal, nro_ingreso,
		codigo_tercero,codigo_centro from contaweb.facturacion
		where
		codigo_empresa = #{codigo_empresa} and codigo_sucursal =
		#{codigo_sucursal}
		<if test="centro_vacio != null">
			and (codigo_centro = '' OR codigo_centro is null)
		</if>

	</select>

	<update id="actualizar_centro" parameterType="healthmanager.modelo.bean.Admision">
		update
		contaweb.facturacion set codigo_centro = #{codigo_centro}
		where
		codigo_empresa = #{codigo_empresa} and codigo_sucursal =
		#{codigo_sucursal} and nro_ingreso = #{nro_ingreso} and
		codigo_tercero
		= #{nro_identificacion}
	</update>

	<select id="existe" resultType="java.lang.Boolean">
		select count(1) != 0 AS exist from contaweb.facturacion
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="id_factura != null">
				AND id_factura = #{id_factura}
			</if>
		</trim>
	</select>


	<select id="existePorParametro" resultType="java.lang.Boolean">
		select count(1) != 0 AS exist from contaweb.facturacion
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="codigo_empresa != null">
				AND codigo_empresa = #{codigo_empresa}
			</if>
			<if test="codigo_sucursal != null">
				AND codigo_sucursal = #{codigo_sucursal}
			</if>
			<if test="id_factura != null">
				AND id_factura = #{id_factura}
			</if>
			<if test="codigo_tercero != null">
				AND codigo_tercero = #{codigo_tercero}
			</if>
			<if test="nro_ingreso != null">
				AND nro_ingreso = #{nro_ingreso}
			</if>
			<if test="documento_externo != null">
				AND documento_externo = #{documento_externo}
			</if>
			<if test="tipo != null">
				AND tipo = #{tipo}
			</if>
		</trim>
	</select>

	<update id="anularFacturaAgrupadaCapitada" parameterType="java.util.Map">
		update
		contaweb.facturacion set factura = '' ,
		estado = 'PEND'
		where id_factura = #{id_factura}
	</update>

	<select id="totalizarSumasDescuentos" parameterType="java.util.Map"
		resultType="java.lang.Double">
		select
		sum(fac.valor_total - fac.dto_factura
		- fac.valor_copago -
		fac.dto_copago) from contaweb.facturacion fac
		where codigo_empresa =
		#{codigo_empresa} and
		codigo_sucursal = #{codigo_sucursal}
		<if test="factura != null"> AND factura = #{factura}</if>
		<if test="tipo != null"> AND tipo = #{tipo}</if>
		<if test="codigo_administradora != null"> AND codigo_administradora = #{codigo_administradora}</if>
		<if test="fecha_in != null"><![CDATA[ AND CAST(fecha AS DATE) >= #{fecha_in}]]></if>
		<if test="fecha_fn != null"><![CDATA[ AND CAST(fecha AS DATE) <= #{fecha_fn}]]></if>
		<if test="estado != null"> AND estado = #{estado}</if>
		<if test="contratos_listado != null">
			AND id_plan IN
			<foreach collection="contratos_listado" item="i" open="("
				separator="," close=")">
				#{i}
			</foreach>
		</if>
	</select>

	<update id="actualizarCodigoFacturaCapitada" parameterType="java.util.Map">
		update contaweb.facturacion
		set
		estado = 'FACT' ,
		factura =
		#{factura_cap}
		where codigo_empresa = #{codigo_empresa} and
		codigo_sucursal = #{codigo_sucursal}
		<if test="factura != null"> AND factura = #{factura}</if>
		<if test="tipo != null"> AND tipo = #{tipo}</if>
		<if test="codigo_administradora != null"> AND codigo_administradora = #{codigo_administradora}</if>
		<if test="fecha_in != null"><![CDATA[ AND CAST(fecha AS DATE) >= #{fecha_in}]]></if>
		<if test="fecha_fn != null"><![CDATA[ AND CAST(fecha AS DATE) <= #{fecha_fn}]]></if>
		<if test="estado != null"> AND estado = #{estado}</if>
		<if test="contratos_listado != null">
			AND id_plan IN
			<foreach collection="contratos_listado" item="i" open="("
				separator="," close=")">
				#{i}
			</foreach>
		</if>
	</update>

	<!-- servicios -->
	<sql id="sql_servicios">
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test="parameter != null">${parameter} like '${value}'</if>
			<if test="tipo_in != null">
			    AND tipo IN 
			    <foreach collection="tipo_in" item="item" open="(" separator="," close=")"> 
			        #{item} 
			    </foreach>
			</if>
		</trim>
		<if test="limite_paginado != null">
			${limite_paginado}
		</if>
	</sql>

	<select id="getTotalServicios" parameterType="java.util.Map"
		resultType="java.lang.Long">
		SELECT COUNT(1) AS total FROM public.vr_servicios
		<include refid="sql_servicios" />
	</select>

	<select id="listarServicios" parameterType="java.util.Map"
		resultType="java.util.Map">
		SELECT
		id,
		cantidad_maxima,
		nombre,
		tipo_descripcion,
		tabla,
		codigo_presentacion
		FROM
		public.vr_servicios
		<include refid="sql_servicios" />
	</select>
	
	<select id="getCantidadMaximaServicio" parameterType="java.util.Map"
	   resultType="java.lang.Integer" >
	    SELECT cantidad_maxima::INTEGER
		FROM public.vr_servicios
		WHERE id = #{id}
		AND tabla = #{tabla}
	</select>
	<!-- servicios -->

</mapper>
